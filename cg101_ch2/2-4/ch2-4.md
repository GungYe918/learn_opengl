# CH2 — Vectors: dot/cross, directions, normals (No matrices yet)

## CH2-4. dot/cross의 결합: reflection, orthonormality, 그리고 수치적 안정성(numerical stability)

### 1) 본 소제목의 학습 범위

본 소제목은 CH2-2(dot product)와 CH2-3(cross product)의 결합으로부터 파생되는 핵심 벡터 연산을 정리하여, 이후 조명(lighting) 및 좌표계(coordinate system) 논의의 전제 조건을 확정한다. 본 소제목은 OpenGL API나 GL 코드와 무관하게 수학적 개념만으로 구성되며, matrix 도입은 하지 않는다. 다루는 항목은 다음으로 한정한다.

* reflection(반사) 벡터의 표준 공식과 도출 구조
* orthonormal(직교정규) 조건의 의미와 검사 방식
* dot/cross가 안정적으로 의미를 갖기 위한 전제(정규화, 단위, epsilon)
* right-handedness(오른손 좌표계)와 orientation의 일관성 개념(정의 수준)

---

### 2) reflection(반사) 벡터: dot product의 대표적 응용

#### 2.1 문제 정의

어떤 표면의 unit normal (\hat{n})과, 표면에 “들어오는 방향” unit vector (\hat{v})가 주어졌다고 하자. 이때 (\hat{v})를 (\hat{n})에 대해 반사시킨 방향 (\hat{r})를 정의하는 것이 reflection 문제이다. graphics에서 이 연산은 specular(정반사) 모델의 구성 요소로 반복 사용된다.

#### 2.2 표준 공식

가장 널리 쓰이는 reflection 공식은 다음과 같이 서술된다.

[
\vec{r} = \vec{v} - 2(\vec{v}\cdot \hat{n})\hat{n}
]

여기서 (\hat{n})은 unit normal이어야 한다. (\vec{v}) 또한 unit vector이면 (\vec{r}) 역시 unit vector가 되는 것이 이상적이며, 수치 오차가 있으면 사후 정규화가 사용된다.

#### 2.3 구조적 해석(보고서식 요약)

* ((\vec{v}\cdot \hat{n}))는 (\vec{v})의 (\hat{n}) 방향 scalar projection이다.
* ((\vec{v}\cdot \hat{n})\hat{n})는 (\vec{v})의 (\hat{n}) 방향 벡터 projection이다.
* 반사는 “normal 방향 성분을 부호 반전시키는 연산”으로 이해할 수 있으며, 그 결과가 위 공식으로 정리된다.

즉, dot product는 “normal 방향 성분을 정량화”하여 반사 연산을 닫힌 형태(closed form)로 제공한다.

---

### 3) orthonormal(직교정규) 조건: dot/cross의 의미를 고정시키는 전제

#### 3.1 정의

세 개의 3D unit vector (\hat{x}, \hat{y}, \hat{z})가 다음을 만족하면 orthonormal basis를 이룬다고 서술한다.

1. 정규화(normalized):
   [
   |\hat{x}|=|\hat{y}|=|\hat{z}|=1
   ]

2. 직교(orthogonal):
   [
   \hat{x}\cdot\hat{y}=0,\quad \hat{y}\cdot\hat{z}=0,\quad \hat{z}\cdot\hat{x}=0
   ]

이 조건은 CH4에서 좌표계 변환을 논의할 때 “기저(basis)” 개념의 핵심 전제가 된다. 다만 본 챕터에서는 matrix로 확장하지 않고, dot/cross의 해석이 깔끔하게 유지되는 조건으로서만 다룬다.

#### 3.2 cross product와 basis의 일관성

오른손 규약(right-hand rule)을 채택하는 경우, 다음 관계가 orientation의 표준 형태로 사용된다.

[
\hat{x} \times \hat{y} = \hat{z}
]

이 식은 “(x,y) 평면의 법선이 z 방향”이라는 방향성까지 포함한다. 동일한 벡터 집합이라도 순서를 바꾸면 부호가 반전되므로, (\hat{y}\times\hat{x}=-\hat{z})가 성립한다. 따라서 orthonormality는 단지 “서로 직교한다”가 아니라, “orientation까지 일관된 규약으로 고정된다”는 성격을 갖는다.

---

### 4) numerical stability: dot/cross를 실제 계산에서 신뢰 가능하게 만들기

#### 4.1 epsilon의 필요성

실수 연산은 floating-point로 수행되며, 다음과 같은 현상이 필연적으로 발생한다.

* 길이가 1이어야 하는 unit vector의 length가 (0.99999994) 또는 (1.00000012)로 나타남
* 직교해야 하는 내적이 0이 아니라 매우 작은 값((10^{-7}) 수준)으로 나타남

따라서 “정확한 0/1 비교”는 원칙적으로 피해야 하며, epsilon 기반 비교가 사용된다.

예:

* (|\vec{a}\cdot\vec{b}| < \varepsilon)이면 “직교로 간주”
* (||\vec{v}| - 1| < \varepsilon)이면 “unit vector로 간주”

#### 4.2 acos 사용 시 clamp의 필요성

각도를 구하기 위해
[
\theta = \arccos(\hat{a}\cdot\hat{b})
]
를 사용할 때, (\hat{a}\cdot\hat{b})는 이론적으로 ([-1,1]) 범위이지만 수치 오차로 약간 벗어날 수 있다. 이 경우 (\arccos)가 NaN을 반환할 수 있으므로, 다음이 표준 안전 절차로 서술된다.

[
c = \text{clamp}(\hat{a}\cdot\hat{b}, -1, 1)
]

#### 4.3 cross product의 degeneracy

(\vec{a}\times\vec{b})의 크기
[
|\vec{a}\times\vec{b}| = |\vec{a}|,|\vec{b}|,\sin\theta
]
에서 (\theta \approx 0) 또는 (\theta \approx \pi)이면 (\sin\theta \approx 0)이므로 결과가 0 vector에 가까워진다. 이는 다음을 의미한다.

* 두 벡터가 거의 평행(parallel)하면, 외적으로 얻는 normal이 수치적으로 불안정해진다.
* 삼각형 면적이 매우 작거나 거의 일직선인 경우, normal 계산이 노이즈에 취약하다.

따라서 실제 시스템에서는 “입력 geometry의 품질” 또는 “fallback 전략”이 중요해진다. 본 챕터에서는 이 사실을 전제로만 기록하고, 구체적인 해결 전략(예: robust geometry 처리)은 CH5 이후의 실전 단계로 유보한다.

---

### 5) right-handedness와 orientation: 정의 수준에서의 고정

graphics에서 좌표계는 관례적으로 right-handed 또는 left-handed 중 하나로 고정된다. 본 과정에서는 Modern OpenGL 교재 흐름에 따라 right-handedness를 기본 규약으로 가정하는 것이 자연스럽다. 다만 이 소제목에서는 다음 사실만 확정한다.

* cross product는 right-hand rule에 의해 방향이 결정된다.
* triangle vertex ordering(winding)의 선택은 triangle normal의 방향을 결정한다.
* 이 방향성은 “앞/뒤” 판정, culling, lighting 등 여러 단계에서 동일하게 유지되어야 한다.

즉, orientation은 단발성 계산값이 아니라, 시스템 전체에서 일관되게 유지되어야 하는 규약(constraint)이다.